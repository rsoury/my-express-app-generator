{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["import express from 'express';\nimport path from 'path';\nimport favicon from 'serve-favicon';\nimport logger from 'morgan';\nimport cookieParser from 'cookie-parser';\nimport session from 'express-session';\nimport bodyParser from 'body-parser';\nimport stylus from 'stylus';\nimport compression from 'compression';\nimport lusca from 'lusca';\nimport Opbeat from 'opbeat';\nimport routes from './routes/index';\nimport Database from './config/sql';\n\nconst app = express();\napp.use(compression());\nconst port = process.env.PORT || 5550;\n\n//Handle Database\nconst sql = new Database(app.get('env'));\napp.set('sql', sql);\n\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'pug');\n\n//app.js is being run from the dist folder.\napp.use(favicon(path.join(__dirname, 'favicon.ico')));\napp.use(logger('dev'));\napp.use(bodyParser.json({ limit: '50mb' }));\napp.use(bodyParser.urlencoded({ extended: false, limit: '50mb' }));\napp.use(cookieParser());\napp.use(require('stylus').middleware(path.join(__dirname, 'public')));\napp.use(express.static(path.join(__dirname, 'public'), { maxAge: 31557600 }));\n\napp.use(session({\n  secret: 'IActuallyAmStartingToBelieveThisSecretIsImportant',\n  resave: true,\n  saveUninitialized: true,\n}));\n\n//Configure Lusca Security\napp.use(lusca({\n  csrf: app.get('env') === 'production',\n  csp: {\n    policy: {\n      'default-src': '* \\'self\\' \\'unsafe-inline\\'',\n      'img-src': '* \\'self\\' data:; ',\n      'script-src': '* \\'self\\' \\'unsafe-inline\\'',\n      'style-src': '* \\'unsafe-inline\\'',\n      'font-src': '* \\'self\\' \\'unsafe-inline\\' data:;',\n    }\n  },\n  xframe: 'SAMEORIGIN',\n  p3p: 'dkwadlkawjkldjalkwdj',\n  hsts: {maxAge: 31536000, includeSubDomains: true, preload: true},\n  xssProtection: true\n}));\n\n//Expiry Headers\napp.use((req, res, next) => {\n  const maxAge = 31557600;\n  if (!res.getHeader('Cache-Control')){\n    res.setHeader('Cache-Control', 'public, max-age=' + (maxAge / 1000));\n  }\n  next();\n});\n\n// Handle robots.txt\napp.use((req, res, next) => {\n  console.log(req.url);\n  if(req.url == '/robots.txt' || req.url == '/robots.txt/'){\n    res.type('text/plain');\n    res.send(`\n      User-Agent: *\n      Allow: /\n    `);\n  }else{\n    next();\n  }\n});\n\n//Routes\napp.use('/', routes);\n\n// catch 404 and forward to error handler\napp.use((req, res, next) => {\n  const err = new Error('Not Found');\n  err.status = 404;\n  next(err);\n});\n\n// error handlers\n\n// development error handler\n// will print stacktrace\nif (app.get('env') === 'development') {\n  app.use((err, req, res, next) => {\n    res.status(err.status || 500);\n    res.render('error', {\n      message: err.message,\n      error: err\n    });\n  });\n}\n\n// production error handler\n// no stacktraces leaked to user\napp.use((err, req, res, next) => {\n  res.status(err.status || 500);\n  res.render('error', {\n    message: err.message,\n    error: {}\n  });\n});\n\n\nmodule.exports = app;\napp.listen(port, () => {\n  console.log('Listening on port: ' + port);\n});"],"sourceRoot":"/source/"}